name: CI
on:
  push:
    branches: [master]
  pull_request:
    branches: [master]
jobs:
  CI:
    name: Gonza y Mati
    runs-on: ubuntu-latest

    steps:



      - name: Checkout code
        uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 14
          cache: 'npm'


      - name: Cache node modules
        id: cache-npm
        uses: actions/cache@v3
        env: 
         cache-name: cache-node-modules
        with:
          path:  ${{ steps.cache-npm.outputs.dir }}
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}-
            ${{ runner.os }}-build-
            ${{ runner.os }}-

      - if: ${{ steps.cache-npm.outputs.cache-hit != 'true' }}
        name: Install node_modules
        #continue-on-error: true
        run: npm ci

    #  - name: Cache node modules
    #    id: cache-npm
    #    uses: actions/cache@v3
    #    env: 
    #      cache-name: cache-node-modules
    #    with:
    #      path: ~/.npm/node_modules
    #      key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}
    #      restore-keys: |
    #        ${{ runner.os }}-build-${{ env.cache-name }}-
    #        ${{ runner.os }}-build-
    #        ${{ runner.os }}-
    #  - if: ${{ steps.cache-npm.outputs.cache-hit != 'true' }}
    #    name: Install node_modules
    #    #continue-on-error: true
    #    run: npm ci
      
    # - name: Install packages
    #  run: npm ci

      - name: Test & Build
        run: npm run build
